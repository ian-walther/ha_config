light:
  - platform: template
    lights:
      office_display_cabinet_light:
        unique_id: office_display_cabinet_light
        friendly_name: "Office Display Cabinet"
      
        value_template: "{{ state_attr('light.light_strip_1_light', 'brightness') | int > 0 }}"
        level_template: "{{ state_attr('light.light_strip_1_light', 'brightness') | int }}"
      
        # Advertise full 2000â€“6500 K
        min_mireds_template: 154
        max_mireds_template: 500
      
        # Show real mapped CT when in CT mode; otherwise show 2700K (370 mireds)
        temperature_template: >-
          {% set src = 'light.light_strip_1_light' %}
          {% if state_attr(src, 'color_mode') == 'color_temp' and state_attr(src, 'color_temp') is not none %}
            {{ ((state_attr(src,'color_temp')|float - 158.0) / (495.0 - 158.0) * (370.0 - 154.0) + 154.0) | round(0) | int }}
          {% else %}
            370
          {% endif %}
      
        hs_template: >-
          {% set hs = state_attr('light.light_strip_1_light','hs_color') %}
          {% if hs is sequence and hs|length == 2 %}
            ({{ (hs[0] | float) | round(1) }}, {{ (hs[1] | float) | round(1) }})
          {% else %}
            (0, 0)
          {% endif %}
      
        turn_on:
          service: light.turn_on
          target:
            entity_id: light.light_strip_1_light
      
        turn_off:
          service: light.turn_off
          target:
            entity_id: light.light_strip_1_light
      
        set_level:
          service: light.turn_on
          target:
            entity_id: light.light_strip_1_light
          data:
            brightness: "{{ brightness }}"
      
        set_temperature:
          service: script.apply_kelvin_map
          data:
            entity: light.light_strip_1_light
            ui_mired: "{{ color_temp }}"
            transition: "{{ (transition | default(0)) | float }}"
      
        set_hs:
          service: light.turn_on
          target:
            entity_id: light.light_strip_1_light
          data:
            hs_color:
              - "{{ h }}"
              - "{{ s }}"
      
        supports_transition_template: "{{ true }}"
