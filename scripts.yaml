pair_all_sonos:
  alias: sonos-join_all_to_kitchen
  sequence:
  - action: media_player.join
    metadata: {}
    data:
      group_members:
      - media_player.hallway
      - media_player.foyer
      - media_player.ians_office
      - media_player.bar
      - media_player.living_room_3
      - media_player.master_bathroom
      - media_player.kitchen_sonos_move
      - media_player.guest_room
      - media_player.studio
      - media_player.master_bedroom
    target:
      entity_id: media_player.kitchen
  icon: mdi:music
  mode: single
set_sonos_volume_to_normal:
  alias: sonos-set_all_volumes_for_whole_house
  sequence:
  - data:
      volume_level: 0.14
    target:
      entity_id: media_player.foyer
    action: media_player.volume_set
  - data:
      volume_level: 0.16
    target:
      entity_id: media_player.ians_office
    action: media_player.volume_set
  - data:
      volume_level: 0.15
    target:
      entity_id: media_player.kitchen
    action: media_player.volume_set
  - data:
      volume_level: 0.15
    target:
      entity_id: media_player.living_room_3
    action: media_player.volume_set
  - data:
      volume_level: 0.16
    target:
      entity_id: media_player.bar
    action: media_player.volume_set
  - data:
      volume_level: 0.14
    target:
      entity_id: media_player.hallway
    action: media_player.volume_set
  - data:
      volume_level: 0.14
    target:
      entity_id: media_player.master_bedroom
    action: media_player.volume_set
  - data:
      volume_level: 0.22
    target:
      entity_id: media_player.master_bathroom
    action: media_player.volume_set
  - target:
      entity_id: media_player.guest_room
    data:
      volume_level: 0.23
    action: media_player.volume_set
  - target:
      entity_id: media_player.kitchen_sonos_move
    data:
      volume_level: 0.07
    action: media_player.volume_set
  mode: parallel
  icon: mdi:music
  max: 10
unjoin_all_sonos:
  alias: sonos-unjoin_all
  sequence:
  - action: media_player.unjoin
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.garage
      - media_player.foyer
      - media_player.hallway
      - media_player.ians_office
      - media_player.living_room_3
      - media_player.master_bathroom
      - media_player.master_bedroom
      - media_player.bar
      - media_player.kitchen
      - media_player.kitchen_sonos_move
      - media_player.guest_room
      - media_player.studio
  - data: {}
    action: script.sonos_living_room_tv
  mode: parallel
  icon: mdi:music
  max: 10
sonos_pair_master_suite:
  alias: sonos-master_suite-pair
  sequence:
  - data: {}
    action: script.unjoin_all_sonos
  - action: media_player.join
    metadata: {}
    data:
      group_members:
      - media_player.master_bathroom
    target:
      entity_id: media_player.master_bedroom
  mode: single
  icon: mdi:music
sonos_master_suite_set_wake_up_volume:
  alias: sonos-master_suite-set_wake_up_volume
  sequence:
  - target:
      entity_id: media_player.master_bedroom
    data:
      volume_level: 0.2
    action: media_player.volume_set
  - data:
      volume_level: 0.2
    target:
      entity_id: media_player.master_bathroom
    action: media_player.volume_set
  mode: single
  icon: mdi:music
sonos_master_suite_play_news:
  alias: sonos-master_suite-play_news
  sequence:
  - service: script.sonos_pair_master_suite
    data: {}
  - service: script.sonos_master_suite_set_wake_up_volume
    data: {}
  - service: media_player.play_media
    target:
      entity_id: media_player.master_bedroom
    data:
      media_content_id: FV:2/34
      media_content_type: favorite_item_id
    metadata:
      title: 115 - FOX News Headlines 24/7
      thumbnail: http://pri.art.prod.streaming.siriusxm.com/images/chan/49/da02fd-cbbe-3eb5-fcbd-e622c6f873a7.png
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
  icon: mdi:music
sonos_kitchen_outlaw_country:
  alias: sonos-kitchen-outlaw_country
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/0
      media_content_type: favorite_item_id
    metadata:
      title: 1 Outlaw Country
      thumbnail: http://pri.art.prod.streaming.siriusxm.com/images/chan/0a/b074e4-723e-342c-d9e8-a08070ae1e5a.png
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
  icon: mdi:music-note
sonos_kitchen_real_jazz:
  alias: sonos-kitchen-real_jazz
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/17
      media_content_type: favorite_item_id
    metadata:
      title: 67 - Real Jazz
      thumbnail: http://pri.art.prod.streaming.siriusxm.com/images/chan/33/b249c6-348b-fa7e-fb70-c4fa0703077a.png
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
  icon: mdi:music-note
sonos_kitchen_1st_wave:
  alias: sonos-kitchen-1st_wave
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/30
      media_content_type: favorite_item_id
    metadata:
      title: 33 - 1st Wave
      thumbnail: http://pri.art.prod.streaming.siriusxm.com/images/chan/aa/f1101b-0f97-f2d6-9b02-b89a601552e7.png
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
sonos_living_room_tv:
  alias: sonos-living_room-tv
  sequence:
  - service: media_player.select_source
    data:
      source: TV
    target:
      device_id: fc219315fecab48f433600c823cb9afe
  mode: single
fireplace_on:
  alias: fireplace-on
  sequence:
  - service: remote.send_command
    target:
      device_id: 3a204b0f2e22341abf5f0561281f1717
    data:
      device: fireplace
      command: power
  mode: single
fireplace_off:
  alias: fireplace-off
  sequence:
  - service: remote.send_command
    target:
      device_id: 3a204b0f2e22341abf5f0561281f1717
    data:
      num_repeats: 2
      delay_secs: 1
      hold_secs: 0
      device: fireplace
      command: power
  mode: single
sonos_kitchen_xmu:
  alias: sonos-kitchen-xmu
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/5
      media_content_type: favorite_item_id
    metadata:
      title: 5 SiriusXMU
      thumbnail: http://pri.art.prod.streaming.siriusxm.com/images/chan/d4/90b873-225a-5421-3625-7c461647d398.png
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
sonos_kitchen_classic_vinyl:
  alias: sonos-kitchen-classic_vinyl
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/1
      media_content_type: favorite_item_id
    metadata:
      title: 2 Classic Vinyl
      thumbnail: http://pri.art.prod.streaming.siriusxm.com/images/chan/07/092b78-3321-ff97-4cbc-94d11099c0fd.png
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
sonos_kitchen_lithium:
  alias: sonos-kitchen-lithium
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/3
      media_content_type: favorite_item_id
    metadata:
      title: 6 Lithium
      thumbnail: http://pri.art.prod.streaming.siriusxm.com/images/chan/85/1675f1-3155-fe4a-871d-b344efc868bb.png
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
sonos_kitchen_poprocks:
  alias: sonos-kitchen-poprocks
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/6
      media_content_type: favorite_item_id
    metadata:
      title: 4 PopRocks
      thumbnail: http://pri.art.prod.streaming.siriusxm.com/images/chan/d8/ad939e-fd44-0d88-cdc6-5fd6f7e58942.png
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
sonos_kitchen_myradio:
  alias: sonos-kitchen-myradio
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/20
      media_content_type: favorite_item_id
    metadata:
      title: Ian Walther’s Station
      thumbnail: https://is1-ssl.mzstatic.com/image/thumb/Features124/v4/7b/1d/f0/7b1df048-0017-8ac0-98c9-735f14849606/mza_7507996640781423701.png/400x400bb.jpg
      media_class: genre
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.item.audioItem.audioBroadcast
  mode: single
garage_door_open:
  alias: air_out_garage
  sequence:
  - parallel:
    - device_id: 29e62d33a0aa193574479d3dcb040649
      domain: cover
      entity_id: fdadcde9180fc0e8d1bc975179eaa529
      type: open
    - action: switch.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: switch.garage_fan_new
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - parallel:
    - device_id: 29e62d33a0aa193574479d3dcb040649
      domain: cover
      entity_id: fdadcde9180fc0e8d1bc975179eaa529
      type: close
    - action: light.turn_off
      metadata: {}
      data:
        transition: 10
      target:
        device_id: dabcf6b082050f340fa90de60055be74
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.garage_fan_new
  mode: single
sonos_kitchen_favorite_songs:
  alias: sonos-kitchen-favorite_songs
  sequence:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: FV:2/36
      media_content_type: favorite_item_id
    metadata:
      title: Favorite Songs
      thumbnail: https://is1-ssl.mzstatic.com/image/thumb/Features116/v4/e3/6e/33/e36e33de-da6c-71e8-dc2e-fae168c924ba/47a3c06a-ab88-4d36-a040-41d730e71d45.png/400x400cc.png
      media_class: playlist
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: favorites
        media_content_id: ''
      - media_content_type: favorites_folder
        media_content_id: object.container.playlistContainer
  mode: single
wake_up:
  alias: wake_up
  sequence:
  - sequence:
    - alias: Sonos Actions
      sequence:
      - action: script.pair_all_sonos
        metadata: {}
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - action: script.set_sonos_volume_to_normal
        metadata: {}
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - choose:
        - conditions:
          - condition: state
            entity_id: input_select.alarm_music
            state: Outlaw Country
          sequence:
          - action: script.sonos_kitchen_outlaw_country
            metadata: {}
            data: {}
        - conditions:
          - condition: state
            entity_id: input_select.alarm_music
            state: 1st Wave
          sequence:
          - action: script.sonos_kitchen_1st_wave
            metadata: {}
            data: {}
        - conditions:
          - condition: state
            entity_id: input_select.alarm_music
            state: SiriusXMU
          sequence:
          - action: script.sonos_kitchen_xmu
            metadata: {}
            data: {}
        - conditions:
          - condition: state
            entity_id: input_select.alarm_music
            state: Real Jazz
          sequence:
          - action: script.sonos_kitchen_real_jazz
            metadata: {}
            data: {}
    - action: input_boolean.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.bedtime
    - if:
      - condition: state
        entity_id: light.master_bed_all
        state: 'off'
      then:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.master_bed_all
  mode: parallel
  icon: mdi:sun-clock-outline
tv_living_room_art_mode:
  alias: tv-living_room-art_mode
  sequence:
  - service: samsungtv_smart.set_art_mode
    data:
      entity_id: media_player.living_room_tv
  mode: single
tv_living_room_hdmi_4:
  alias: tv-living_room-apple_tv
  sequence:
  - action: media_player.play_media
    target:
      entity_id: media_player.living_room_tv
    data:
      media_content_id: ST_HDMI4
      media_content_type: send_key
    metadata: {}
  mode: single
tv_kitchen_art_mode:
  alias: tv-kitchen-art_mode
  sequence:
  - action: samsungtv_smart.set_art_mode
    metadata: {}
    data:
      entity_id: media_player.kitchen_tv
  mode: single
tv_kitchen_apple_tv:
  alias: tv-kitchen-apple_tv
  sequence:
  - action: media_player.play_media
    target:
      entity_id: media_player.kitchen_tv
    data:
      media_content_id: ST_HDMI4
      media_content_type: send_key
    metadata: {}
  mode: single
tv_kitchen_house:
  alias: tv-kitchen-house
  sequence:
  - action: media_player.play_media
    target:
      entity_id: media_player.kitchen_tv
    data:
      media_content_id: ST_HDMI2
      media_content_type: send_key
    metadata: {}
  mode: single
tv_living_room_house:
  alias: tv-living_room-house
  sequence:
  - action: media_player.play_media
    target:
      entity_id: media_player.living_room_tv
    data:
      media_content_id: ST_HDMI2
      media_content_type: send_key
    metadata: {}
  mode: single
tv_all_house:
  alias: tv-all-house
  sequence:
  - data: {}
    action: script.tv_kitchen_house
  - data: {}
    action: script.tv_living_room_house
  mode: parallel
  max: 10
  description: ''
tv_all_off:
  alias: tv-all-art-mode
  sequence:
  - data: {}
    action: script.tv_kitchen_art_mode
  - data: {}
    action: script.tv_living_room_art_mode
  mode: parallel
  max: 10
  description: ''
tv_kitchen_chromecast:
  alias: tv-kitchen-chromecast
  sequence:
  - action: media_player.play_media
    target:
      entity_id: media_player.kitchen_tv
    data:
      media_content_id: ST_HDMI1
      media_content_type: send_key
    metadata: {}
  mode: single
tv_living_room_turn_on:
  alias: tv-all-on
  sequence:
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: switch.samsung_the_frame_43
        state: 'off'
      - condition: state
        entity_id: switch.samsung_the_frame_75
        state: 'off'
    then:
    - action: switch.turn_on
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.samsung_the_frame_43
        - switch.samsung_the_frame_75
    else:
    - if:
      - condition: state
        entity_id: switch.samsung_the_frame_43
        state: 'off'
      then:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.samsung_the_frame_43
    - if:
      - condition: state
        entity_id: switch.samsung_the_frame_75
        state: 'off'
      then:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.samsung_the_frame_75
  description: ''
tv_turn_all_off:
  alias: tv-all-off
  sequence:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - switch.samsung_the_frame_43
      - switch.samsung_the_frame_75
  description: ''
tv_house_respond_to_change_2:
  alias: tv-house-respond_to_change
  sequence:
  - if:
    - condition: state
      entity_id: input_boolean.is_someone_home
      state: 'on'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'
    then:
    - action: script.tv_living_room_turn_on
      metadata: {}
      data: {}
    else:
    - action: script.tv_turn_all_off
      metadata: {}
      data: {}
  description: ''
tv_office_apple_tv:
  sequence:
  - action: media_player.play_media
    target:
      entity_id: media_player.office_tv
    data:
      media_content_id: ST_HDMI2
      media_content_type: send_key
    metadata: {}
  alias: tv-office-apple_tv
  mode: single
  description: ''
tv_office_house:
  sequence:
  - action: media_player.play_media
    target:
      entity_id: media_player.office_tv
    data:
      media_content_id: ST_HDMI1
      media_content_type: send_key
    metadata: {}
  alias: tv-office-house
  mode: single
  description: ''
sonos_pair_downstairs:
  sequence:
  - action: media_player.join
    metadata: {}
    data:
      group_members:
      - media_player.living_room_3
      - media_player.ians_office
      - media_player.kitchen_sonos_move
    target:
      entity_id: media_player.kitchen
  alias: sonos-pair_downstairs
  description: ''
house_respond_to_change:
  sequence:
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_boolean.bedtime
        state: 'off'
      - condition: state
        entity_id: input_boolean.is_someone_home
        state: 'on'
    then:
    - parallel:
      - sequence:
        - action: switch.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_main_floor
        - action: switch.turn_off
          metadata: {}
          data: {}
          target:
            entity_id:
            - switch.kitchen_air_cleaner_switch
            - switch.living_room_air_cleaner_switch
        - action: switch.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_hallway
        - action: switch.turn_off
          metadata: {}
          data: {}
          target:
            entity_id:
            - switch.adaptive_lighting_sleep_mode_master_bathroom
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: light.bar_all_lights
        - action: switch.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: switch.adaptive_lighting_sleep_mode_master_sitting_area
      - action: script.tv_living_room_turn_on
        metadata: {}
        data: {}
        enabled: false
    else:
    - parallel:
      - sequence:
        - action: switch.turn_on
          metadata: {}
          data: {}
          target:
            entity_id:
            - switch.kitchen_air_cleaner_switch
            - switch.living_room_air_cleaner_switch
        - action: switch.turn_on
          metadata: {}
          data: {}
          target:
            entity_id:
            - switch.adaptive_lighting_sleep_mode_hallway
        - action: switch.turn_on
          metadata: {}
          data: {}
          target:
            entity_id:
            - switch.adaptive_lighting_sleep_mode_master_bathroom
        - action: light.turn_off
          metadata: {}
          data:
            transition: 2
          target:
            entity_id: light.main_floor
        - action: light.turn_off
          metadata: {}
          data:
            transition: 2
          target:
            entity_id: light.foyer_lights
      - action: script.tv_turn_all_off
        metadata: {}
        data: {}
        enabled: false
  alias: house-respond_to_change
  description: ''
alarm_set_to_630:
  sequence:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      time: 06:30:00
    target:
      entity_id: input_datetime.alarm_time
  alias: alarm_set-to-630
  description: ''
alarm_set_to_7:
  sequence:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      time: 07:00:00
    target:
      entity_id: input_datetime.alarm_time
  alias: alarm_set-to-700
  description: ''
alarm_set_to_730:
  sequence:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      time: 07:30:00
    target:
      entity_id: input_datetime.alarm_time
  alias: alarm_set-to-730
  description: ''
alarm_set_to_800:
  sequence:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      time: 08:00:00
    target:
      entity_id: input_datetime.alarm_time
  alias: alarm_set-to-800
  description: ''
apply_kelvin_map:
  alias: Apply Kelvin map (2000–6500K; fake 2000–2700K)
  mode: parallel
  fields:
    entity:
      description: Physical light to control
      example: light.office_cove_original
    ui_mired:
      description: Requested UI mireds (154..500 ≙ 6500..2000 K)
      example: 370
    transition:
      description: Optional transition seconds
      example: 1
  sequence:
  - variables:
      light_entity: '{{ entity }}'
      ui_mired_clamped: '{% set v = ui_mired | float %} {{ [500.0, [154.0, v] | max]
        | min }}'
      kelvin: '{{ 1000000.0 / ui_mired_clamped }}'
      dev_mired: '{% set ui = ui_mired_clamped %} {% set m = ((ui - 154.0) / (370.0
        - 154.0) * (495.0 - 158.0) + 158.0) %} {{ [495.0, [158.0, m] | max] | min
        }}'
      b_out: '{{ state_attr(light_entity, ''brightness'') | int(200) }}'
      t_numeric: '{{ (transition | default(0)) | float }}'
      cool_bias: 0.25
      anti_pink: 0.03
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ kelvin | float >= 2700 }}'
      sequence:
      - service: light.turn_on
        data:
          entity_id: '{{ light_entity }}'
          color_temp: '{{ dev_mired | round(0) | int }}'
          brightness: '{{ b_out }}'
          transition: '{{ t_numeric }}'
    default:
    - variables:
        k_fake: '{{ [2000.0, [kelvin, 2700.0] | min] | max }}'
        t_base: '{{ (k_fake - 2000.0) / 700.0 }}'
        t: '{{ [1.0, (t_base | float) + cool_bias * (1.0 - (t_base | float)) ] | min
          }}'
        x2000: 0.522
        y2000: 0.405
        x2700: 0.459
        y2700: 0.41
        x_core: '{{ x2000 + (x2700 - x2000) * (t | float) }}'
        y_core: '{{ y2000 + (y2700 - y2000) * (t | float) }}'
        s: '{{ 4.0 * (t | float) * (1.0 - (t | float)) }}'
        x: '{{ x_core | float }}'
        y: '{{ (y_core | float) + (anti_pink | float) * (s | float) }}'
    - service: light.turn_on
      data:
        entity_id: '{{ light_entity }}'
        xy_color:
        - '{{ x | float }}'
        - '{{ y | float }}'
        brightness: '{{ b_out }}'
        transition: '{{ t_numeric }}'
tv_kitchen_turn_on:
  sequence:
  - action: opnsense.send_wol
    metadata: {}
    data:
      interface: lan
      mac: 10:2b:41:bf:60:56
  - delay:
      hours: 0
      minutes: 0
      seconds: 3
      milliseconds: 0
  - action: media_player.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: media_player.kitchen_tv
  alias: tv-kitchen_turn_on
  description: ''
